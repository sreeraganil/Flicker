{% extends "base.html" %}

{% block title %}
    {% if cat %}{{ cat|title }} Flicker - Free HD & 4K Wallpapers
    {% elif q %}Search results for "{{ q }}"
    {% else %}Flicker | Browse & Download HD, 4K, 8K Wallpapers
    {% endif %}
{% endblock title %}

{% block meta_description %}
    {% if cat %}Explore our curated collection of '{{ cat|title }}' wallpapers. Download thousands of free, high-quality {{ cat }} backgrounds for your desktop and mobile devices.
    {% elif q %}Find the perfect free wallpaper for '{{ q }}'. Browse our hand-picked collection of high-resolution images matching your search.
    {% else %}Discover and download thousands of stunning, high-quality free wallpapers for all your devices. Explore popular categories like Nature, Abstract, 4K, Tech, and more. Updated daily.
    {% endif %}
{% endblock meta_description %}

{% block meta_keywords %}
    {% if cat %}{{ cat }}, {{ cat }} wallpapers, {{ cat }} backgrounds, free download, 4k background, high resolution {{ cat }}
    {% elif q %}{{ q }}, {{ q }} wallpaper, free wallpapers, background images, {{ q }} 4K
    {% else %}flicker, flicker wallpapers, free wallpapers, 4K wallpapers, 8K wallpapers, AI wallpapers, AI generated art, desktop backgrounds, mobile wallpapers, HD backgrounds, wallpaper download, aesthetic, minimalist, nature, abstract, tech, gaming, anime, cool backgrounds, space, cars, cityscapes, iPhone wallpaper, Android background, PC, Ultra HD, high resolution, free background images, wallpaper site, Midjourney wallpapers
    {% endif %}
{% endblock meta_keywords %}

{% block canonical_url %}
    {# This is crucial for SEO to avoid duplicate content on paginated/filtered pages #}
    {% if cat %}{{ request.scheme }}://{{ request.get_host }}{{ request.path }}?cat={{ cat }}
    {% elif q %}{{ request.scheme }}://{{ request.get_host }}{{ request.path }}?q={{ q }}
    {% else %}{{ request.scheme }}://{{ request.get_host }}{{ request.path }}
    {% endif %}
{% endblock canonical_url %}

{% block content %}
<div class="w-full">
      <div class="relative rounded-2xl overflow-hidden mb-8 text-center h-80 flex flex-col justify-center items-center text-white p-5 bg-gray-900">
         <div class="absolute inset-0 bg-gradient-to-r from-primary-600/80 to-primary-800/80"></div>
         <div class="relative z-10">
            <h1 class="text-4xl md:text-6xl font-extrabold mb-4 tracking-tight">Discover Stunning Wallpapers</h1>
            <p class="text-lg md:text-xl text-primary-100 mb-8 max-w-3xl mx-auto">High-quality, free wallpapers for all your devices</p>
            
            <form method="get" class="max-w-xl mx-auto">
               <div class="relative shadow-lg">
                  <div class="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none">
                     <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gray-400" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z" clip-rule="evenodd" />
                     </svg>
                  </div>
                  <input 
                     name="q" 
                     value="{{ q }}" 
                     placeholder="Search for nature, abstract, 4K..."
                     class="w-full px-12 py-2 md:py-4 rounded-full text-gray-900 focus:outline-none focus:ring-2 focus:ring-primary-500 transition-shadow duration-300"
                  >
                  <button 
                     type="submit"
                     class="absolute inset-y-0 right-0 px-4 md:px-8 py-2 md:py-4 bg-primary-600 text-white font-semibold rounded-r-full hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-primary-500 transition-colors duration-300"
                  >
                     Search
                  </button>
               </div>
            </form>
         </div>
   </div>

      <div class="mb-10">
      <div class="flex flex-wrap items-center justify-center gap-3">
         <a href="{% url 'wallpapers:home' %}" class="px-5 py-2 text-sm font-semibold rounded-full transition-colors duration-200
            {% if not cat %} bg-primary-600 text-white shadow-md {% else %} bg-white text-gray-700 hover:bg-gray-100 {% endif %}">
            All
         </a>
         {% for value, label in categories %}
            <a href="?cat={{ value }}" 
               class="px-5 py-2 text-sm font-semibold rounded-full transition-colors duration-200 capitalize
                  {% if cat == value %} bg-primary-600 text-white shadow-md {% else %} bg-white text-gray-700 hover:bg-gray-100 {% endif %}">
               {{ label }}
            </a>
         {% endfor %}
      </div>
   </div>
   
      {% if page_obj.object_list %}
      <div class="columns-1 sm:columns-2 md:columns-3 lg:columns-4 gap-4 space-y-4">
         {% for wp in page_obj.object_list %}
            <div class="break-inside-avoid group relative rounded-xl overflow-hidden shadow-md hover:shadow-xl transition-all duration-300 ease-in-out">
               <a href="{% url 'wallpapers:detail' wp.slug %}" class="block">
                  <img 
                     src="{{ wp.view_link }}" 
                     alt="{{ wp.title }}" 
                     class="w-full h-auto object-cover transition-transform duration-300 group-hover:scale-105"
                     loading="lazy"
                  >
                  <div class="absolute inset-0 bg-gradient-to-t from-black/70 via-transparent to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300"></div>
                  
                  <div class="absolute inset-0 p-4 flex flex-col justify-between opacity-0 group-hover:opacity-100 transition-opacity duration-300">
                     <div class="flex justify-between items-start">
                        {% if wp.is_featured %}
                           <div class="bg-yellow-400 text-yellow-900 px-2 py-1 rounded-full text-xs font-bold flex items-center">
                              <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3 mr-1" viewBox="0 0 20 20" fill="currentColor">
                                 <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z" />
                              </svg>
                              Featured
                           </div>
                        {% else %}
                           <div></div> 
                        {% endif %}
                     </div>
                     <div>
                        <h3 class="font-bold text-white text-lg">{{ wp.title }}</h3>
                        <p class="text-sm text-gray-300">{{ wp.resolution_label }} â€¢ {{ wp.downloads }} downloads</p>
                     </div>
                  </div>
               </a>
               <a href="{% url 'wallpapers:download' wp.slug %}" class="absolute top-3 right-3 w-9 h-9 bg-white/20 backdrop-blur-sm opacity-0 group-hover:opacity-100 rounded-full flex items-center justify-center text-white hover:bg-white/30 transition-colors">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                     <path fill-rule="evenodd" d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm3.293-7.707a1 1 0 011.414 0L9 10.586V3a1 1 0 112 0v7.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z" clip-rule="evenodd" />
                  </svg>
               </a>
            </div>
         {% endfor %}
      </div>
   {% else %}
            <div class="text-center py-20 bg-white rounded-2xl shadow-sm">
         <svg xmlns="http://www.w3.org/2000/svg" class="mx-auto h-16 w-16 text-gray-300" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
         </svg>
         <h3 class="mt-4 text-xl font-semibold text-gray-800">No Wallpapers Found</h3>
         <p class="mt-2 text-gray-500">Your search didn't match any wallpapers. Try a different term!</p>
         <a href="{% url 'wallpapers:home' %}" class="mt-6 inline-flex items-center px-6 py-3 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-primary-600 hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500">
            Browse All Wallpapers
         </a>
      </div>
   {% endif %}

      {% if page_obj.paginator.num_pages > 1 %}
      <nav class="mt-16 flex items-center justify-center" aria-label="Pagination">
         {% if page_obj.has_previous %}
            <a href="?page={{ page_obj.previous_page_number }}&q={{ q }}&cat={{ cat }}&res={{ res }}" class="relative inline-flex items-center px-4 py-2 rounded-l-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50">
               <span>Previous</span>
            </a>
         {% endif %}

         {% for num in page_obj.paginator.page_range %}
            {% if page_obj.number == num %}
               <span aria-current="page" class="relative z-10 inline-flex items-center px-4 py-2 border border-primary-500 bg-primary-600 text-sm font-medium text-white">
                  {{ num }}
               </span>
            {% elif num > page_obj.number|add:'-3' and num < page_obj.number|add:'3' %}
               <a href="?page={{ num }}&q={{ q }}&cat={{ cat }}&res={{ res }}" class="relative inline-flex items-center px-4 py-2 border border-gray-300 bg-white text-sm font-medium text-gray-700 hover:bg-gray-50">
                  {{ num }}
               </a>
            {% endif %}
         {% endfor %}

         {% if page_obj.has_next %}
            <a href="?page={{ page_obj.next_page_number }}&q={{ q }}&cat={{ cat }}&res={{ res }}" class="relative inline-flex items-center px-4 py-2 rounded-r-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50">
               <span>Next</span>
            </a>
         {% endif %}
      </nav>
   {% endif %}
</div>
{% endblock %}