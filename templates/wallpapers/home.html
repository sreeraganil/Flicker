{% extends "base.html" %}

{% block title %}
    {% if cat %}{{ cat|title }} Wallpapers | Free HD & 4K Backgrounds{% endif %}
    {% if q %}Search: "{{ q }}" | Flicker Wallpapers{% endif %}
    {% if not cat and not q %}Flicker | HD, 4K & 8K Wallpaper Collection{% endif %}
{% endblock %}

{% block meta_description %}
    {% if cat %}Download free {{ cat }} wallpapers in HD, 4K and 8K resolutions. Curated collection of {{ cat }} backgrounds for desktop and mobile.{% endif %}
    {% if q %}Search results for "{{ q }}" - Find perfect wallpapers matching your query in our collection.{% endif %}
    {% if not cat and not q %}Discover thousands of free high-quality wallpapers in HD, 4K and 8K resolutions. Updated daily with new backgrounds.{% endif %}
{% endblock %}

{% block content %}
<div class="w-full">
  <!-- Hero Section -->
  <div class="relative rounded-2xl overflow-hidden mb-8 text-center h-60 md:h-80 flex flex-col justify-center items-center text-white p-5 bg-gray-900">
    <div class="absolute inset-0 bg-gradient-to-r from-[#0284c7cc] to-[#075985cc]"></div>
    <div class="relative z-10 px-4">
      <h1 class="text-3xl md:text-5xl font-bold mb-4 tracking-tight">
        {% if cat %}{{ cat|title }} Wallpapers{% endif %}
        {% if q %}Search: "{{ q }}"{% endif %}
        {% if not cat and not q %}Stunning Free Wallpapers{% endif %}
      </h1>
      <p class="text-lg text-blue-100 mb-6 max-w-3xl mx-auto">
        {% if cat %}Browse our curated {{ cat }} collection{% endif %}
        {% if q %}Find wallpapers matching your search{% endif %}
        {% if not cat and not q %}High-quality backgrounds for all devices{% endif %}
      </p>
      
      <form method="get" class="max-w-xl mx-auto w-full">
        <div class="relative shadow-lg">
          <div class="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none">
            <svg class="h-5 w-5 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
            </svg>
          </div>
          <input 
            name="q" 
            value="{{ q }}" 
            placeholder="Search nature, abstract, 4K..."
            class="w-full bg-white px-12 py-3 rounded-full text-gray-900 focus:outline-none focus:ring-2 focus:ring-blue-500"
          >
          <button type="submit" class="absolute inset-y-0 right-0 px-6 bg-blue-600 text-white font-medium rounded-r-full hover:bg-blue-700">
            Search
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- Category Filters -->
  <div class="mb-8 px-2">
    <div class="flex flex-wrap justify-center gap-2">
      <a href="{% url 'wallpapers:home' %}" class="px-4 py-2 text-sm font-medium rounded-full transition-colors
        {% if not cat %} bg-blue-600 text-white shadow-md {% else %} bg-white text-gray-700 hover:bg-gray-100 {% endif %}">
        All
      </a>
      {% for value, label in categories %}
        <a href="?cat={{ value }}" class="px-4 py-2 text-sm font-medium rounded-full transition-colors capitalize
          {% if cat == value %} bg-blue-600 text-white shadow-md {% else %} bg-white text-gray-700 hover:bg-gray-100 {% endif %}">
          {{ label }}
        </a>
      {% endfor %}
    </div>
  </div>
  
  <!-- Wallpapers Grid -->
  {% if page_obj.object_list %}
    <div class="columns-1 sm:columns-2 md:columns-3 lg:columns-4 gap-4 space-y-4 px-2">
      {% for wp in page_obj.object_list %}
        <div class="break-inside-avoid group relative rounded-xl overflow-hidden shadow-md hover:shadow-lg transition-all">
          <a href="{% url 'wallpapers:detail' wp.slug %}" class="block">
            <img 
              src="{{ wp.view_link }}" 
              alt="{{ wp.title }}" 
              class="w-full h-auto object-cover transition-transform duration-300 group-hover:scale-105"
              loading="lazy"
              width="400"
              height="225"
            >
            <div class="absolute inset-0 bg-gradient-to-t from-black/70 via-transparent to-transparent opacity-0 group-hover:opacity-100 transition-opacity"></div>
            
            <div class="absolute inset-0 p-4 flex flex-col justify-between opacity-0 group-hover:opacity-100 transition-opacity">
              <div>
                {% if wp.is_featured %}
                  <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-bold bg-yellow-400 text-yellow-900">
                    Featured
                  </span>
                {% endif %}
              </div>
              <div>
                <h3 class="font-bold text-white text-lg">{{ wp.title }}</h3>
                <p class="text-sm text-gray-300">{{ wp.resolution_label }} â€¢ {{ wp.downloads }} downloads</p>
              </div>
            </div>
          </a>
          <a href="{% url 'wallpapers:download' wp.slug %}" class="absolute top-3 right-3 w-9 h-9 bg-white/20 backdrop-blur-sm opacity-0 group-hover:opacity-100 rounded-full flex items-center justify-center text-white hover:bg-white/30 transition-colors">
            <svg class="h-5 w-5" fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm3.293-7.707a1 1 0 011.414 0L9 10.586V3a1 1 0 112 0v7.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z" clip-rule="evenodd" />
            </svg>
          </a>
        </div>
      {% endfor %}
    </div>
  {% else %}
    <div class="text-center py-16 bg-white rounded-xl shadow-sm">
      <svg class="mx-auto h-16 w-16 text-gray-300" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.172 16.172a4 4 0 015.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
      </svg>
      <h3 class="mt-4 text-lg font-medium text-gray-900">No wallpapers found</h3>
      <p class="mt-2 text-gray-600">Try adjusting your search or browse our categories</p>
      <a href="{% url 'wallpapers:home' %}" class="mt-4 inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-blue-600 hover:bg-blue-700">
        Browse All
      </a>
    </div>
  {% endif %}

  <!-- Pagination -->
  {% if page_obj.paginator.num_pages > 1 %}
    <div class="mt-12 flex items-center justify-between border-t border-gray-200 pt-8 px-4">
      <div>
        {% if page_obj.has_previous %}
          <a href="?page={{ page_obj.previous_page_number }}&q={{ q }}&cat={{ cat }}" class="inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50">
            Previous
          </a>
        {% endif %}
      </div>
      
      <div class="hidden md:flex">
        {% for num in page_obj.paginator.page_range %}
          {% if num == page_obj.number %}
            <span class="px-4 py-2 border border-blue-500 text-sm font-medium rounded-md text-white bg-blue-600">
              {{ num }}
            </span>
          {% elif num > page_obj.number|add:'-3' and num < page_obj.number|add:'3' %}
            <a href="?page={{ num }}&q={{ q }}&cat={{ cat }}" class="px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 ml-2">
              {{ num }}
            </a>
          {% endif %}
        {% endfor %}
      </div>
      
      <div>
        {% if page_obj.has_next %}
          <a href="?page={{ page_obj.next_page_number }}&q={{ q }}&cat={{ cat }}" class="inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50">
            Next
          </a>
        {% endif %}
      </div>
    </div>
  {% endif %}
</div>
{% endblock %}